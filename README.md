## 2. 案例: Reduce 端实现 JOIN

### 2.1. 需求

> 假如数据量巨大，两表的数据是以文件的形式存储在 HDFS 中, 需要用 MapReduce 程序来实现以下 SQL 查询运算
>
> ```sql
> select  a.id,a.date,b.name,b.category_id,b.price 
> from t_order a 
> left join t_product b on a.pid = b.id
> ```

##### 商品表

| id    | name  | category_id | price |
| ----- | ----- | ----------- | ----- |
| P0001 | 小米5  | 1000        | 2000  |
| P0002 | 锤子T1 | 1000        | 3000  |
| P0003 | 华为P8 | 1000        | 3500  |


##### 订单数据表

| id   | date       | pid   | amount |
| ---- | ---------- | ----- | ------ |
| 1001 | 2015-07-10 | P0001 | 2      |
| 1002 | 2015-07-11 | P0001 | 1      |
| 1003 | 2015-07-10 | P0002 | 3      |
| 1004 | 2015-07-12 | P0001 | 4      |
| 1005 | 2015-07-13 | P0003 | 1      |
| 1006 | 2015-07-14 | P0002 | 2      |
| 1007 | 2015-07-15 | P0001 | 5      |
| 1008 | 2015-07-16 | P0003 | 2      |
| 1009 | 2015-07-17 | P0001 | 3      |
| 1010 | 2015-07-18 | P0002 | 4      |

### 解决思路
- 分批在一个reducer中缓存同一pid的数据，加载完后进行合并

